{% extends "store/base.html" %}

{% load i18n %}
{% load crispy_forms_tags %}
{% load static i18n %}

{% block head_title %}{% trans "store" %}{% endblock %}
{% block css %}
    {{ block.super }}

        <link href="{% static 'css/store/list-items.css' %}" rel="stylesheet">
{% endblock %}

{% block main_store %}

<div class="items-list-container">
<div class="well well-sm row">
    <strong class="col-sm-2">Category Title</strong>
    <span class="col-sm-2"> 10001 results</span>
      <div class=" row col-sm-3">
        <label class="col-sm-2">Price</label>
        <div class="col-sm-3">
            <input id="min-price" type="text" style="width:50px;" name="minPrice" placeholder="min" value="{{minPrice}}">
        </div>
        <div class="col-sm-4">
            <input id="max-price" type="text" style="width:50px;" name="maxPrice" placeholder="max" value="{{maxPrice}}">
        </div>            
        <button class="btn btn-primary btn-xs col-sm-2 filter-query">Go</button>
      </div>
    <div class="form-group col-sm-3">
      <select class="form-control" id="sortby">
        <option value="best_match">BestMatch</option>
        <option value="price_dsc">Price: high to low</option>
        <option value="price_asc">Price: low to high</option>
        <option value="rate">Most reviewed</option>
        <option value="publication_date">Publication date</option>
      </select>
    </div>
    
    <div class="btn-group ">
        <a href="#" id="list" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-th-list">
        </span>List</a> <a href="#" id="grid" class="btn btn-default btn-sm"><span
            class="glyphicon glyphicon-th"></span>Grid</a>
    </div>
</div>
<div id="products" class="row list-group">
    {% for product in pagination.object_list %}
    <div class="item  col-xs-4 col-lg-4">
        <div class="thumbnail">
            <img class="group list-group-image" src="{{ product.media.image.url }}" alt="" />
            <div class="caption">
                <h4 class="group inner list-group-item-heading">
                    <a href="{% url 'item' slug=product.product.slug %}">{{ product.product.name |slice:":100" }}</a></h4>
                <h6 class="group inner list-group-item-heading">
                    <small> by <strong> {{ product.product.brand }} </strong></small></h6>    
                <p class="group inner list-group-item-text">
                    {{ product.product.description |slice:":200" }}</p>
                
                <div class="row">
                    <div class="item-rate col-xs-12 col-md-6">
                        <div class="rateit" data-rateit-mode="font" data-rateit-step="0.1" data-rateit-value="2.333" data-rateit-ispreset="true" data-rateit-readonly="true"></div>
                        <span >(10)</span>
                    </div>
                    <div class="col-xs-12 col-md-6">
                        <p class="lead">
                            {{ product.product.price }}</p>
                    </div>
                    <div class="col-xs-12 col-md-6">
                        <a class="btn btn-success" href="http://www.jquery2dotnet.com">Add to cart</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>  
</div>
<div class="pagination-container">
<nav aria-label="..." >
  <ul class="pagination">
    <li class="page-item {%if not pagination.has_previous %} disabled {% endif %}">
      <a class="page-link" href="?page={{pagination.number|add:'-1'}}" tabindex="-1">Previous</a>
    </li>
    {% if pagination_ext.remain_left %}
        <li class="page-item"> <a class="page-link">...</a> </li>
    {% endif %}
    {% for p in pagination_ext.ex_range %}
        <li class="page-item {% if pagination.number == p %} active {% endif %}"><a class="page-link" href="?page={{p}}">{{p}}</a></li>
    {% endfor %}
    {% if pagination_ext.remain_right %}
        <li class="page-item"> <a class="page-link">...</a>  </li>
    {% endif %}
    <li class="page-item {%if not pagination.has_next %} disabled {% endif %}">
      <a class="page-link" href="?page={{pagination.number|add:'1'}}" >Next</a> 
    </li>
  </ul>
</nav>
</div>

{% endblock %}

{% block javascript %}

    {{ block.super }}
          <script src="{% static 'js/store/store.js' %}"></script>
          
    <script>
        $("#sortby").val('{{sortType}}');
        
        var context = {}
        var query = "{{query}}";
        if( query )
            context['q'] = "{{query}}";
                    
        var minPrice = $("input[name='minPrice']").val();
        var maxPrice = $("input[name='maxPrice']").val();
        
        if (minPrice)
            context['minPrice'] = minPrice;
        if (maxPrice)
            context['maxPrice'] = maxPrice;
        
        context['SortType'] = $("#sortby").val();
        
        // sending search and filter queries using jQuery
        $('.filter-query').click(function() { 
            var minPrice = $("input[name='minPrice']").val();
            var maxPrice = $("input[name='maxPrice']").val();
            
            if (minPrice)
                context['minPrice'] = minPrice;
            if (maxPrice)
                context['maxPrice'] = maxPrice;
            
            window.location.replace("{% url 'store' category=category %}?"+$.param(context));
        });
        
        $("#sortby").change(function(){
            context['SortType'] = $("#sortby").val();
            window.location.replace("{% url 'store' category=category %}?"+$.param(context));
        });
    </script>
{% endblock %}